# SQL injection UNION attacks
When an application is vulnerable to [[SQL Injection]] and the results of the query are returned within the application's responses, the [[SQL#UNION]] keyword can be used to retrieve data from other tables within the database.
To carry out this attack and attacker must ensure that an attack meets the [[SQL#UNION]] requirements. This generally involves figuring out:
* How many columns are being return from the original query ?
* Which columns returned from the original query are of suitable data type to hold the results from the injected query ?
## Determining the number of columns required
We can determine the number of columns required using 2 different methods.

The first method involves inject a series of [[SQL#ORDER BY]] clauses and incrementing the specified columns index until an error occurs
```txt
' ORDER BY 1 -- 
' ORDER BY 2 --
etc.
```
When the specified column index exceeds the number of actual columns, database returns and error.

The second method involves submitting a series of [[SQL#UNION]] [[SQL#SELECT]] payloads specifying a different number of [[SQL#NULL]] values.
```txt
' UNION SELECT NULL --
' UNION SELECT NULL, NULL --
etc.
```
If the number of nulls does not match the number of columns, the database return an error
The reason for using [[SQL#NULL]] as the values returned from the injected [[SQL#SELECT]] query is that the data types in each dolumn must be compatible between the original and the injected queries.
On Oracle, every [[SQL#SELECT]] query must use the `FROM` keyword and specify a valid table. There is a built-in table on Oracle called `dual` which can be used for this purpose.
## Finding columns with a useful data type
Generally, the interessting data that you want to retireve will be in string from, so  you need to find one or more columns in the original query results whose data type is or is compatible with string data.
You can probe each column to test whetever it can hold string data by submitting a series of [[SQL#UNION]] [[SQL#SELECT]] payloads that place a string value into each column in turn.
```text
' UNION SELECT 'a',NULL,NULL,NULL-- 
' UNION SELECT NULL,'a',NULL,NULL-- 
' UNION SELECT NULL,NULL,'a',NULL-- 
' UNION SELECT NULL,NULL,NULL,'a'--
```
If the data type of a column is not compatible with string data the database will return an error.
### Retrieving interesting data
When you have determined the number of columns returned by the original query and found which columns can hold strng data, you are in a position to retieve interesting data.
Example:
* The original query return two columns, both of which can hold string data
* The injection point is quoted string within the `WHERE` clause
* The database contains a table called `users` with the columns `username` and `password`
```
' UNION SELECT username, password FROM users -- 
```
### Retrieving multiple values within a single column
If a query returns a single column or less than we need, we can concatenate the values together including a suitable separator to let us distinguish combined values.
In an Oracle database we can do this with
```text
' UNION SELECT username || '~' || password FROM users -- 
```
