# DOM-based XSS
This vulnerability arises when JavaScript takes data from an attacker-controllable source and passes it to a sink that supports dynamic code execution, such as `eval()` or `innerHTML`


## Testing for DOM-based XSS
### Testing HTML sinks
To test for DOM XSS in an HTML sink place a random aplphanumeric string into the source then use developer tools to inspect the HTML and find where your string appears.

For each location where your string apperas within the DOM you need to identify the context. Based on this context you need to refine your input to see how it is processed.

### Testing JavaScript execution sinks
With these sinks your input doesn't necessarily appear anywherew within the DOM, so you can't search for it. Instead you'll need to use the JavaScript debugger to determine whether and how your input is sent to a sink.

## Exploiting DOM XSS
Different sources and sinks have differing properties and behavior that can affect exploitability and determine what techniques are necessary.

### Sources and sinks in third-party dependancies
#### DOM XSS in jQuery
jQuery's `attr()` function can change the attributes of DOM elements.
```javascript
$(function() { 
	$('#backLink').attr("href",(newURLSearchParams(window.location.search)).get('returnUrl')); });
```

You can exploit this by modifying the URL so that the `location.search` source contains a malicious JavaScipt URL.

A classic DOM XSS vulnerability was caused by websites using `$()` selector in conjunction with the `location.hash` source for animations or auto-scrolling. This behavior was often implemented using a vulnerable `hashchange` event handler:
```javascript
$(window).on('hashchange', function() { 
			var element = $(location.hash); 
			element[0].scrollIntoView(); 
});
```

To actually exploit this vulnerability you'll need to find a way to trigger a `hashchange` event without user interaction One of the simplest ways of doing this is to deliver your exploit via an `iframe`:
```html
<iframe src="https://vulnerable-website.com#" onload="this.src+='<img src=1 onerror=alert(1)>'">
```

#### DOM XSS in AngularJS
When a site uses the `ng-app` attribute on an HTML element it will be processed by AngularJS. In this case AngularJS will execute JavaScript inside double curly braces `{{}}` that can occur directly in HTML or inside attributes.

## DOM XSS combined with reflected and stored data
In a [[Reflected XSS]]+DOM vulnerability, the server processes data frfom the request, and echoes the data into the response. The reflected data might be placed into a JavaScript string literal or a data item within the DOM, such as a form field.

In a [[Stored XSS]]+DOM vulnerability the server receives data from one request stores it and then includes the data in a later response. A script within the later response contains a sink which then processes the data in an unsafe way.